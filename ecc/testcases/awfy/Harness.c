// Generated by Oberon+ IDE (Mono) 0.9.106 on 2024-07-13T01:26:30

#include "Harness.h"

struct Run$Run * Harness$processArguments(struct OBX$Array$2 args) {
    struct Run$Run * r;
    struct OBX$Array$2* $t0;
    r = 0;
    r = Run$create(($t0 = (&args),(struct OBX$Array$1){$t0->$2,1,&((char *)$t0->$a)[0*$t0->$2]}));
    if( ((args).$1 > 1) ) {
        if( ((args).$1 > 2) ) {
        } 
    } 
    return r;
}

void Harness$printUsage() {
    Out$String((const struct OBX$Array$1){50,0,OBX$FromUtf("Harness [benchmark] [num-iterations [inner-iter]]",50,0)});
    Out$Ln();
    Out$Ln();
    Out$String((const struct OBX$Array$1){41,0,OBX$FromUtf("  benchmark      - benchmark class name ",41,0)});
    Out$Ln();
    Out$String(((struct OBX$Array$1 [1]){OBX$StrJoin(&(const struct OBX$Array$1){58,0,OBX$FromUtf("  num-iterations - number of times to execute benchmark, ",58,0)},0,&(const struct OBX$Array$1){11,0,OBX$FromUtf("default: 1",11,0)},0)})[0]);
    Out$Ln();
    Out$String(((struct OBX$Array$1 [1]){OBX$StrJoin(&(const struct OBX$Array$1){53,0,OBX$FromUtf("  inner-iter     - number of times the benchmark is ",53,0)},0,&(const struct OBX$Array$1){28,0,OBX$FromUtf("executed in an inner loop, ",28,0)},0)})[0]);
    Out$Ln();
    Out$String((const struct OBX$Array$1){58,0,OBX$FromUtf("                   which is measured in total, default: 1",58,0)});
    Out$Ln();
}

void Harness$main(struct OBX$Array$2 args) {
    struct Run$Run * r;
    void* $t0;
    void (* $t1)(void*);
    r = 0;
    if( ((args).$1 < 1) ) {
        Harness$printUsage();
        return ;
    } 
    r = Harness$processArguments(args);
    ($t1 = ((struct Run$Run *)($t0 = &(*r)))->class$->runBenchmark, $t1($t0));
    ($t1 = ((struct Run$Run *)($t0 = &(*r)))->class$->printTotal, $t1($t0));
}

void Harness$run(struct OBX$Array$1 what, int32_t numIterations, int32_t innerIterations) {
    struct Run$Run * r;
    void* $t0;
    void (* $t1)(void*, int32_t);
    void (* $t2)(void*);
    r = 0;
    r = Run$create(what);
    if( ((void*)r == (void*)0) ) {
        Out$String((const struct OBX$Array$1){32,0,OBX$FromUtf("ERROR could not find benchmark ",32,0)});
        Out$String(what);
        Out$Ln();
        return ;
    } 
    ($t1 = ((struct Run$Run *)($t0 = &(*r)))->class$->setNumIterations, $t1($t0, numIterations));
    ($t1 = ((struct Run$Run *)($t0 = &(*r)))->class$->setInnerIterations, $t1($t0, innerIterations));
    ($t2 = ((struct Run$Run *)($t0 = &(*r)))->class$->runBenchmark, $t2($t0));
    ($t2 = ((struct Run$Run *)($t0 = &(*r)))->class$->printTotal, $t2($t0));
}

static int initDone$ = 0;
void Harness$init$(void) {
    if(initDone$) return; else initDone$ = 1;
    Out$init$();
    Run$init$();
}
OBX$Cmd Harness$cmd$(const char* name) {
    if( name == 0 ) return Harness$init$;
    if( strcmp(name,"printUsage") == 0 ) return Harness$printUsage;
    return 0;
}
